<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Water Bubbly - Orders</title>
  <link rel="stylesheet" href="../css/style.css">
  <script defer src="../js/app.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="container nav-inner">
      <div class="brand"><img src="../assets/logo.svg" alt="logo"/> Water Bubbly</div>
      <div class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="products.html">Book Water</a>
        <a href="orders.html" class="active">Orders</a>
        <a href="profile.html">My Profile</a>
        <a href="help.html">Help</a>
        <a href="#" class="btn-outline" onclick="WB.signOut()">Sign out</a>
      </div>
    </div>
  </nav>
  <main class="container">
    <div class="card">
      <h2>Your Orders</h2>
      <table class="table" id="orders-table">
        <thead>
          <tr>
            <th>Order ID</th><th>Date</th><th>Items</th><th>Total</th><th>Status</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>
  <footer class="footer">© 2025 Water Bubbly</footer>

  <script>
    const s = WB.ensureAuthOrRedirect();
    const phone = s.phone;
    const tbody = document.querySelector('#orders-table tbody');

    function render() {
      const orders = WB.getOrders(phone);
      tbody.innerHTML = '';
      orders.forEach(o => {
        const tr = document.createElement('tr');
        const itemsText = o.items.map(i => `${WB.nameFor(i.id)} x${i.qty}`).join(', ');
        tr.innerHTML = `
          <td>${o.id}</td>
          <td>${new Date(o.createdAt).toLocaleString()}</td>
          <td>${itemsText}</td>
          <td>₹${o.totals.total}</td>
          <td>${o.status}</td>
          <td><button class="btn-outline">Next Status</button></td>
        `;
        const flow = ['Pending', 'Confirmed', 'Delivered'];
        if (o.status === flow[flow.length - 1]) {
          tr.querySelector('button').disabled = true;
        } else {
          tr.querySelector('button').addEventListener('click', () => {
            WB.progressOrder(phone, o.id);
            render();
          });
        }
        tbody.appendChild(tr);
      });
    }

    render();
  </script>
</body>
</html>

